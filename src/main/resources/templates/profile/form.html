<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Mi Perfil — gastAPP</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet"/>
  <link th:href="@{/css/style.css}" rel="stylesheet"/>
</head>
<body>
  <nav th:replace="~{fragments/navbar :: nav}"></nav>
  <main class="container py-4">
    <div th:if="${message}" class="alert alert-success alert-gastapp alert-dismissible fade show">
      <span th:text="${message}"></span>
      <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>

    <h1 class="page-title mb-4">Mi Perfil</h1>

    <div class="card card-gastapp">
      <div class="card-body p-4">
        <form th:action="@{/profile}" th:object="${profile}" method="post" enctype="multipart/form-data">

          <div class="row g-4">
            <div class="col-12 col-md-4 text-center">
              <div class="mb-3">
                 <!-- Placeholder or Current Image -->
                 <!-- If we have a user object in session or fetched via ControllerAdvice, we could show current image here.
                      Since we are in the form, we can't easily see the current saved image unless we add it to the model separately or use the user session.
                      For now, just the upload input. -->
                 <label class="form-label d-block">Foto de perfil</label>
                 <div class="mb-2">
                   <i class="bi bi-person-circle text-secondary" style="font-size: 5rem;"></i>
                 </div>
                 <input type="file" th:field="*{foto}" class="form-control" accept="image/*"/>
                 <p th:if="${#fields.hasErrors('foto')}" th:errors="*{foto}" class="text-danger small mt-1"></p>
              </div>
            </div>

            <div class="col-12 col-md-8">
              <div class="mb-3">
                <label class="form-label">Nombre</label>
                <input type="text" th:field="*{nombre}" class="form-control" required/>
                <p th:if="${#fields.hasErrors('nombre')}" th:errors="*{nombre}" class="text-danger small mt-1"></p>
              </div>

              <div class="mb-3">
                <label class="form-label">Email</label>
                <input type="email" th:field="*{email}" class="form-control" required/>
                <p th:if="${#fields.hasErrors('email')}" th:errors="*{email}" class="text-danger small mt-1"></p>
              </div>

              <hr class="my-4">
              <h5 class="mb-3">Cambiar contraseña</h5>

              <div class="mb-3">
                <label class="form-label">Contraseña Actual</label>
                <input type="password" th:field="*{currentPassword}" class="form-control" placeholder="Necesaria para establecer una nueva"/>
                <p th:if="${#fields.hasErrors('currentPassword')}" th:errors="*{currentPassword}" class="text-danger small mt-1"></p>
              </div>

              <div class="mb-3">
                <label class="form-label">Nueva Contraseña</label>
                <input type="password" th:field="*{newPassword}" class="form-control" placeholder="Mínimo 6 caracteres"/>
                <p th:if="${#fields.hasErrors('newPassword')}" th:errors="*{newPassword}" class="text-danger small mt-1"></p>
              </div>
            </div>
          </div>

          <div class="mt-4 d-flex justify-content-end gap-2">
            <button type="submit" class="btn btn-gastapp">Guardar cambios</button>
          </div>
        </form>
      </div>
    </div>
  </main>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
